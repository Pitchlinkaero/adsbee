syntax = "proto3";

package adsbee.mqtt.v1;

// Enumerations
enum Band {
  BAND_UNSPECIFIED = 0;
  BAND_1090 = 1;  // Mode S / ADS-B (1090 MHz)
  BAND_UAT = 2;   // UAT (978 MHz)
}

enum FixType {
  FIX_NONE = 0;
  FIX_2D = 1;
  FIX_3D = 2;
}

// Raw packet message (JSON topic: {device_id}/adsb|uat/{ICAO}/raw)
message RawPacket {
  uint64 t_ms = 1;      // Timestamp in milliseconds (from MLAT counter)
  string icao = 2;      // Uppercase hex (6 chars)
  Band band = 3;        // 1090 vs UAT
  uint32 df = 4;        // Downlink format (1090 only, absent for UAT)
  int32 rssi_dbm = 5;   // Signal level in dBm
  bytes hex = 6;        // Raw packet bytes
}

// Aircraft status message (JSON topic: {device_id}/adsb|uat/{ICAO}/status)
message AircraftStatus {
  string icao = 1;      // Uppercase hex (6 chars)
  Band band = 2;        // 1090 vs UAT
  string call = 3;      // Callsign (up to 8 chars)
  string cat = 4;       // ADS-B emitter category code (e.g., A3, C1)
  double lat = 5;       // Degrees (5 decimal places)
  double lon = 6;       // Degrees (5 decimal places)
  int32 alt_ft = 7;     // Baro altitude (feet)
  float hdg_deg = 8;    // Degrees [0..359]
  int32 spd_kts = 9;    // Knots
  int32 vr_fpm = 10;    // Feet per minute
  string sqk = 11;      // 4-digit hex squawk
  bool on_ground = 12;  // True if on ground (gnd=1)
}

// Device telemetry (JSON topic: {device_id}/system/telemetry)
message Telemetry {
  uint32 uptime_sec = 1;
  uint32 msgs_adsb_ps = 2;        // ADS-B messages received per second
  uint32 msgs_mqtt_tx = 3;        // MQTT messages sent (cumulative)
  int32 cpu_temp_c = 4;
  uint32 mem_free_kb = 5;
  int32 noise_floor_dbm = 6;
  bool rx_1090 = 7;
  bool rx_978 = 8;
  bool wifi = 9;
  bool mqtt = 10;
  string fw_ver = 11;             // e.g., "2.3.1"
  uint32 mps_total = 12;          // Optional: total messages per second
  repeated uint32 mps = 13;       // Optional: per-feed messages per second
}

// GPS position (JSON topic: {device_id}/system/gps)
message GPS {
  double lat = 1;        // Latitude (6 decimal places)
  double lon = 2;        // Longitude (6 decimal places)
  float alt_m = 3;       // Altitude in meters
  FixType fix = 4;       // Fix type
  uint32 sats = 5;       // Number of satellites
  float hdop = 6;        // Horizontal dilution of precision
  uint64 ts = 7;         // Timestamp
}
